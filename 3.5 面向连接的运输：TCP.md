### 3.5 面向连接的运输：TCP

#### 3.5.1 TCP连接

TCP被称为是面向连接的原因是在一个应用进程可以开始向另一个应用进程发送数据之前，这两个进程必须先相互握手，即它们必须相互发送某些预备报文段，以建立确保数据传输的参数。

作为TCP连接建立的一部分，连接的双方都将初始化与TCP连接相关的许多TCP变量。

TCP连接是一条逻辑连接，其共同状态仅保留在两个通信端系统的TCP程序中。

TCP连接提供的是全双工服务，意思是：如果一台主机上的进程A与另一台主机上的进程B存在一条TCP连接，那么应用层数据就可以在进程AB之间相互流通。

TCP连接也总是点对点的，即在单个发送方与单个接收方之间的连接。

TCP的三次握手：客户首先发送一个特殊的TCP报文段，服务器用另一个特殊的TCP报文段来响应，最后客户再用第三个特殊报文段作为响应。前两个报文段不承载“有效载荷”，也就是不包含应用层数据，第三个报文段可以承载。

TCP将这些数据引导到该连接的发送缓存里，发送缓存是发起三次握手期间设置的缓存之一。接下来TCP会不时从发送缓存里取出一块数据传递到网络层。

TCP可以从缓存中取出并放入报文段中的数据数量受限于最大报文段长度（MSS）。MSS通常根据最初确定的由本地发送主机发送的最大链路层帧长度（即所谓的最大传输单元（MTU））来设置。设置该MSS要保证一个TCP报文段加上TCP/IP首部长度将适合链路层帧。

#### 3.5.2 TCP报文段结构

![image-20210311005824596](C:\Users\Silhouette76\AppData\Roaming\Typora\typora-user-images\image-20210311005824596.png)

- 源端口号和目的端口号：用于多路复用/分解来自或送到上层应用的数据。
- 报文首部还包括：
  - 32比特的序号字段和确认号字段：用于实现可靠数据传输服务
  - 16比特的接收窗口字段：用于流量控制
  - 4比特的首部长度字段：指示了以32比特的字为单位的TCP首部长度，TCP首部的长度是可变的
  - 可选与变长的选项字段：用于发送方与接收方协商最大报文段长度或在高速网络环境下作用窗口调节因子
  - 标志字段：ACK比特用于指示确认字段中的值是有效的

